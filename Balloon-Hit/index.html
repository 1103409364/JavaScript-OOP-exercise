<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Balloon Hit</title>

    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #81c5fc;
        }

        #layout {
            background-color: #cccccc;
            /*border: 2px solid #333333;*/
            margin: 0 auto;
            width: 80%;
            height: 100%;
        }


        /* div {
            width: 63px;
            height: 234.5px;
            background: url("img/1.png") 0 0 no-repeat;
            background-size: 62px 234.5px;

            position: absolute;
            left: 100px;
            bottom: 0;
        } */

        #container {
            width: 80%;
            height: 100%;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }

        #status {
            text-shadow: 1px 1px 1px #2c2c2c;
            text-align: left;
            color: #ffffff;
            font-size: 20px;
            position: relative;
            z-index: 999;
        }
    </style>
</head>

<body>
    <div id="container">
        <audio id="bgm" src="audio/bgm.mp3" autoplay loop></audio>
        <audio id="boom" src="audio/boom.mp3"></audio>

        <div id="status">
            fps:
            <span id="fps">50</span>
            score:
            <span id="score">0</span>
        </div>
    </div>
    <script src="js/HtmlUtil.js"></script>

    <script>
        // 气球类
        function Balloon() {
            this.container = document.getElementById("container");
            this.containerWidth = parseInt(HtmlUtil.getStyle(this.container, "width"));
            this.left = HtmlUtil.getRandom(0, this.containerWidth - 63);
            this.bottom = -250;
            this.speed = 3;
            this.fps = document.getElementById("fps").textContent;
            this.color = HtmlUtil.getRandom(1, 3);
            // 分数
            this.value = HtmlUtil.getRandom(1, 10);

            this.dom = document.createElement("div");
            this.dom.style =
                "background: url(img/" + this.color + ".png) 0 0 no-repeat;" +
                "background-size: 62px 234.5px;" +
                "width: 63px; height: 234.5px;" +
                "text-align:center;" +
                "padding-top: 10px;" +
                "font-size: 30px;" +
                "color: #fff;" +

                "position: absolute;" +
                "left: " + this.left + "px;" + "bottom: " + this.bottom + "px;";

            this.dom.textContent = this.value;
            this.container.appendChild(this.dom);

            this.dom.addEventListener("click", function () {
                var boom = document.getElementById("boom");
                var scoreElement = document.getElementById("score");
                var score = parseInt(scoreElement.textContent);
                scoreElement.textContent = parseInt(this.textContent) + score;
                // 没有load会导致短时间play两次，第二次无法播放的问题
                boom.load();
                boom.play();
                this.style = "display: none";
            });

            // 备份this
            var _this = this;

            var id = setInterval(function () {
                if (_this.bottom < 1000) {
                    _this.bottom += _this.speed;

                } else {
                    clearInterval(id);
                }
                _this.dom.style.bottom = _this.bottom + "px";
            }, 1000 / _this.fps);
        }

        var gameStart = function () {
            setInterval(function () {
                new Balloon();
            }, 500);
        }

        var __main = function () {
            gameStart();
        }

        __main();
    </script>
</body>

</html>